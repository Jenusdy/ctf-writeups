# ------------------------------
#  INPUT ARRAY (ISI SENDIRI)
# ------------------------------

DAT_00100bc0 = [
    0x17,0x11,0x05,0xB3,0xC1,0x42,0xD0,0x1E,0x38,0x7C,
    0x6B,0x4E,0x22,0x75,0x90,0xA3,0x38,0x0F,0xCD,0x84,
    0xAC,0xF2,0x87,0xAD,0xC1,0x78,0xF9,0x1D,0x92,0x6B,
    0x99,0x4F,0x81,0xC1,0x05,0xB2,0xF1,0x6D,0x69,0x3A,
    0xDB,0xC3,0xBE,0x34,0x0F,0xC8,0x61,0x1F
]

DAT_00100bf0 = [
    0x31,0xD9,0x1F,0x31,0x89,0x13,0x39,0xB2,0x2D,0xEB,
    0xB6,0xD7,0xAF,0x6D,0x56,0x92,0xAF,0xFE,0xF1,0x75,
    0x2B,0x50,0x8C,0xDB,0xEC,0x92,0x06,0x4E,0x74,0xA9,
    0xEE,0x86,0x54,0x88,0x4E,0x0F,0xE0,0x97,0x6F,0xCC,
    0xC3,0xAD,0xEB,0x41,0xAC,0x22,0x37,0x26
]

# ------------------------------
#  PARAMETERS FROM BINARY
# ------------------------------

KEY_IF_FLAGGED = 0x5F9D7BC3
DAT_001054FC = 0          # = 0 means use constant key

FLAG_LEN = 0x2F  # 47 bytes (0..46)

# ------------------------------
#  SOLVER
# ------------------------------

def rotate(b, r):
    r &= 7
    return ((b >> r) | (b << (8 - r))) & 0xFF

flag = []

for u in range(FLAG_LEN):
    # iVar4 computation
    iVar4 = u * 0x1d + 7
    iVar4 = iVar4 + (((iVar4 // 6 + (iVar4 >> 31)) >> 3) - (iVar4 >> 31)) * -0x30

    # key byte
    key = KEY_IF_FLAGGED
    if DAT_001054FC != 0:
        key = DAT_001054F8

    key_byte = (key >> (8 * (u & 3))) & 0xFF

    # main XOR + NOT
    val = ~(DAT_00100bc0[iVar4] ^ DAT_00100bf0[iVar4] ^ key_byte) & 0xFF

    # rotation
    shift = (((u // 7) * -7 + u + 1) & 7)

    dec = rotate(val, shift)

    flag.append(dec)

# print final flag
print("FLAG:", bytes(flag).decode('latin1'))
